sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/types/NavigationMode","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/util/getNormalizedTarget","sap/ui/webc/common/thirdparty/base/util/getActiveElement","sap/ui/webc/common/thirdparty/base/util/TabbableElements","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/util/debounce","sap/ui/webc/common/thirdparty/base/util/isElementInView","./types/TableGrowingMode","./BusyIndicator","./types/TableMode","./CheckBox","./generated/i18n/i18n-defaults","./generated/templates/TableTemplate.lit","./generated/themes/Table.css"],function(e,t,s,i,n,o,r,l,a,d,c,u,h,m,f,g,p,w,b,_,E,v){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=y(t);s=y(s);i=y(i);n=y(n);o=y(o);r=y(r);a=y(a);d=y(d);m=y(m);f=y(f);g=y(g);p=y(p);w=y(w);b=y(b);E=y(E);v=y(v);function y(e){return e&&e.__esModule?e:{default:e}}const R=250;const S=20;const I={tag:"ui5-table",managedSlots:true,fastNavigation:true,slots:{default:{propertyName:"rows",type:HTMLElement,individualSlots:true,invalidateOnChildChange:true},columns:{type:HTMLElement,individualSlots:true,invalidateOnChildChange:{properties:true,slots:false}}},properties:{noDataText:{type:String},growingButtonText:{type:String},growingButtonSubtext:{type:String},hideNoData:{type:Boolean},growing:{type:g.default,defaultValue:g.default.None},busy:{type:Boolean},busyDelay:{type:o.default,defaultValue:1e3},stickyColumnHeader:{type:Boolean},mode:{type:w.default,defaultValue:w.default.None},accessibleName:{type:String,defaultValue:undefined},accessibleNameRef:{type:String,defaultValue:""},_hiddenColumns:{type:Object,multiple:true},_noDataDisplayed:{type:Boolean},_loadMoreActive:{type:Boolean},_columnHeader:{type:Object},_inViewport:{type:Boolean},_allRowsSelected:{type:Boolean}},events:{"row-click":{detail:{row:{type:HTMLElement}}},"popin-change":{detail:{poppedColumns:{}}},"load-more":{},"selection-change":{detail:{selectedRows:{type:Array},previouslySelectedRows:{type:Array}}}}};class T extends t.default{static get metadata(){return I}static get styles(){return v.default}static get render(){return s.default}static get template(){return E.default}static get dependencies(){return[p.default,b.default]}static async onDefine(){T.i18nBundle=await(0,h.getI18nBundle)("@ui5/webcomponents")}constructor(){super();this._columnHeader={id:`${this._id}-columnHeader`,_tabIndex:"0"};this._itemNavigation=new n.default(this,{navigationMode:r.default.Vertical,affectedPropertiesNames:["_columnHeader"],getItemsCallback:()=>[this._columnHeader,...this.rows],skipItemsSize:S});this.fnOnRowFocused=this.onRowFocused.bind(this);this._handleResize=this.popinContent.bind(this);this.fnHandleF7=this._handleF7.bind(this);this.tableEndObserved=false;this.addEventListener("ui5-selection-requested",this._handleSelect.bind(this));this.addEventListener("ui5-_forward-after",this._onForwardAfter.bind(this));this.addEventListener("ui5-_forward-before",this._onForwardBefore.bind(this));this.lastFocusedElement=null;this._forwardingFocus=false;this._prevNestedElementIndex=0}onBeforeRendering(){const e=this.getColumnPropagationSettings();const t=JSON.stringify(e);const s=this.rows.length;const i=this.selectedRows;this.rows.forEach((i,n)=>{if(i._columnsInfoString!==t){i._columnsInfo=e;i._columnsInfoString=JSON.stringify(i._columnsInfo)}i._ariaPosition=T.i18nBundle.getText(_.TABLE_ROW_POSITION,n+1,s);i._busy=this.busy;i.removeEventListener("ui5-_focused",this.fnOnRowFocused);i.addEventListener("ui5-_focused",this.fnOnRowFocused);i.removeEventListener("ui5-f7-pressed",this.fnHandleF7);i.addEventListener("ui5-f7-pressed",this.fnHandleF7);i.mode=this.mode});this.visibleColumns=this.columns.filter((e,t)=>!this._hiddenColumns[t]);this._noDataDisplayed=!this.rows.length&&!this.hideNoData;this.visibleColumnsCount=this.visibleColumns.length;if(this.isMultiSelect){this.visibleColumnsCount+=1}this._allRowsSelected=i.length===this.rows.length;this._prevFocusedRow=this._prevFocusedRow||this.rows[0]}onAfterRendering(){if(this.growsOnScroll){this.observeTableEnd()}this.checkTableInViewport()}onEnterDOM(){this.growingIntersectionObserver=this.getIntersectionObserver();i.default.register(this.getDomRef(),this._handleResize);this._itemNavigation.setCurrentItem(this.rows.length?this.rows[0]:this._columnHeader)}onExitDOM(){i.default.deregister(this.getDomRef(),this._handleResize);this.growingIntersectionObserver.disconnect();this.growingIntersectionObserver=null;this.tableEndObserved=false}_onkeydown(e){if((0,l.isTabNext)(e)||(0,l.isTabPrevious)(e)){this._handleTab(e)}if((0,l.isCtrlA)(e)){e.preventDefault();this.isMultiSelect&&this._selectAll(e)}if((0,l.isUpAlt)(e)||(0,l.isDownAlt)(e)){this._handleArrowAlt(e)}if(((0,l.isUpShift)(e)||(0,l.isDownShift)(e))&&this.isMultiSelect){this._handleArrowNav(e)}if((0,l.isHomeCtrl)(e)){e.preventDefault();this._itemNavigation._handleHome(e);this._itemNavigation._applyTabIndex();this._itemNavigation._focusCurrentItem()}if((0,l.isEndCtrl)(e)){e.preventDefault();this._itemNavigation._handleEnd(e);this._itemNavigation._applyTabIndex();this._itemNavigation._focusCurrentItem()}if(((0,l.isHomeShift)(e)||(0,l.isEndShift)(e))&&this.isMultiSelect){this._handleHomeEndSelection(e)}}_handleTab(e){const t=(0,l.isTabNext)(e);const s=(0,a.default)(e.target);const i=this.getFocusedElementType(e.target);if(this.columnHeaderTabbables.includes(s)){if(t&&this.columnHeaderLastElement===s){return this._focusNextElement(e)}return}if(t&&i==="columnHeader"&&!this.columnHeaderTabbables.length){return this._focusNextElement(e)}if(i==="tableRow"||!i){return}switch(i){case"tableGroupRow":return t?this._focusNextElement(e):this._focusForwardElement(e,false);case"columnHeader":return!t&&this._focusForwardElement(e,false);case"moreButton":if(t){this._focusForwardElement(e,true)}else{e.preventDefault();this.currentElement.focus()}}}_focusNextElement(e){if(!this.growsWithButton){this._focusForwardElement(e,true)}else{this.morеBtn.focus()}}_handleArrowNav(e){const t=this.currentElement.localName==="tr";if(!t){return}const s=this.selectedRows;const i=this.currentItem;const n=this.currentItemIdx;const o=n-1;const r=n+1;const a=this.rows[o];const d=this.rows[r];const c=i.selected;if((0,l.isUpShift)(e)&&!a||(0,l.isDownShift)(e)&&!d){return}if((0,l.isUpShift)(e)){i.selected=i.selected&&!a.selected;a.selected=i.selected||c&&!i.selected;a.focus()}if((0,l.isDownShift)(e)){i.selected=i.selected&&!d.selected;d.selected=i.selected||c&&!i.selected;d.focus()}const u=this.selectedRows;this.fireEvent("selection-change",{selectedRows:u,previouslySelectedRows:s})}_handleHomeEndSelection(e){const t=this.currentElement.localName==="tr";if(!t){return}const s=this.rows;const i=this.selectedRows;const n=this.currentItemIdx;if((0,l.isHomeShift)(e)){s.slice(0,n+1).forEach(e=>{e.selected=true});s[0].focus()}if((0,l.isEndShift)(e)){s.slice(n).forEach(e=>{e.selected=true});s[s.length-1].focus()}const o=this.selectedRows;this.fireEvent("selection-change",{selectedRows:o,previouslySelectedRows:i})}_handleArrowAlt(e){const t=(0,l.isUpAlt)(e);const s=this.getFocusedElementType(e.target);if(t){switch(s){case"tableRow":case"tableGroupRow":this._prevFocusedRow=e.target;return this._onColumnHeaderClick(e);case"columnHeader":return this.morеBtn?this.morеBtn.focus():this._prevFocusedRow.focus();case"moreButton":return this._prevFocusedRow?this._prevFocusedRow.focus():this._onColumnHeaderClick(e)}}else{switch(s){case"tableRow":case"tableGroupRow":this._prevFocusedRow=e.target;return this.morеBtn?this.morеBtn.focus():this._onColumnHeaderClick(e);case"columnHeader":if(this._prevFocusedRow){this._prevFocusedRow.focus()}else if(this.morеBtn){this.morеBtn.focus()}return;case"moreButton":return this._onColumnHeaderClick(e)}}}getFocusedElementType(e){if(e===this.columnHeader){return"columnHeader"}if(e===this.morеBtn){return"moreButton"}if(this.rows.includes(e)){const t=e.hasAttribute("ui5-table-group-row");return t?"tableGroupRow":"tableRow"}}_handleF7(e){const t=e.detail.row;t._tabbables=(0,c.getTabbableElements)(t);const s=(0,d.default)();const i=t._tabbables[this._prevNestedElementIndex]||t._tabbables[0];const n=t._tabbables.indexOf(s);if(!t._tabbables.length){return}if(s===t.root){i.focus()}else if(n>-1){this._prevNestedElementIndex=n;t.root.focus()}}_onfocusin(e){const t=(0,a.default)(e.target);if(!this._isForwardElement(t)){this.lastFocusedElement=t;return}if(!this._forwardingFocus){if(this.lastFocusedElement){this.lastFocusedElement.focus()}else{this.currentElement.focus()}e.stopImmediatePropagation()}this._forwardingFocus=false}_onForwardBefore(e){this.lastFocusedElement=e.detail.target;this._focusForwardElement(e,false);e.stopImmediatePropagation()}_onForwardAfter(e){this.lastFocusedElement=e.detail.target;if(!this.growsWithButton){this._focusForwardElement(e,true)}else{this.morеBtn.focus()}}_focusForwardElement(e,t){this._forwardingFocus=true;this.shadowRoot.querySelector(`#${this._id}-${t?"after":"before"}`).focus()}_isForwardElement(e){const t=e.id;const s=this._getForwardElement(true);const i=this._getForwardElement(false);if(this._id===t||i&&i.id===t){return true}return s&&s.id===t}_getForwardElement(e){const t=e?"after":"before";if(!this[`_${t}Element`]){this[`_${t}Element`]=this.shadowRoot.querySelector(`#${this._id}-${t}`)}return this[`_${t}Element`]}onRowFocused(e){this._itemNavigation.setCurrentItem(e.target)}_onColumnHeaderFocused(e){this._itemNavigation.setCurrentItem(this._columnHeader)}_onColumnHeaderClick(e){if(!e.target){this.columnHeader.focus()}const t=(0,a.default)(e.target);const s=this.columnHeaderTabbables.includes(t);if(!s){this.columnHeader.focus()}}_onColumnHeaderKeydown(e){if((0,l.isSpace)(e)){e.preventDefault();this.isMultiSelect&&this._selectAll()}}_onLoadMoreKeydown(e){if((0,l.isSpace)(e)){e.preventDefault();this._loadMoreActive=true}if((0,l.isEnter)(e)){this._onLoadMoreClick();this._loadMoreActive=true}}_onLoadMoreKeyup(e){if((0,l.isSpace)(e)){this._onLoadMoreClick()}this._loadMoreActive=false}_onLoadMoreClick(){this.fireEvent("load-more")}observeTableEnd(){if(!this.tableEndObserved){this.getIntersectionObserver().observe(this.tableEndDOM);this.tableEndObserved=true}}onInteresection(e){if(e.some(e=>e.isIntersecting)){(0,m.default)(this.loadMore.bind(this),R)}}loadMore(){this.fireEvent("load-more")}_handleSingleSelect(e){const t=this.getRowParent(e.target);if(!t.selected){const e=this.selectedRows;this.rows.forEach(e=>{if(e.selected){e.selected=false}});t.selected=true;this.fireEvent("selection-change",{selectedRows:[t],previouslySelectedRows:e})}}_handleMultiSelect(e){const t=this.getRowParent(e.target);const s=this.selectedRows;t.selected=!t.selected;const i=this.selectedRows;if(i.length===this.rows.length){this._allRowsSelected=true}else{this._allRowsSelected=false}this.fireEvent("selection-change",{selectedRows:i,previouslySelectedRows:s})}_handleSelect(e){this[`_handle${this.mode}`](e)}_selectAll(e){const t=!this._allRowsSelected;const s=this.rows.filter(e=>e.selected);this._allRowsSelected=t;this.rows.forEach(e=>{e.selected=t});const i=t?this.rows:[];this.fireEvent("selection-change",{selectedRows:i,previouslySelectedRows:s})}getRowParent(e){const t=e.parentElement;if(e.hasAttribute("ui5-table-row")){return e}if(t&&t.hasAttribute("ui5-table-row")){return t}this.getRowParent(t)}get columnHeader(){return this.getDomRef()&&this.getDomRef().querySelector(`#${this._id}-columnHeader`)}get"morеBtn"(){return this.growsWithButton&&this.getDomRef()&&this.getDomRef().querySelector(`#${this._id}-growingButton`)}handleResize(e){this.checkTableInViewport();this.popinContent(e)}checkTableInViewport(){this._inViewport=(0,f.default)(this.getDomRef())}popinContent(e){const t=this.getDomRef().getBoundingClientRect();const s=t.width;const i=[];const n=[];this.columns.forEach((e,t)=>{if(s<e.minWidth&&e.minWidth!==Infinity){i[t]={index:t,popinText:e.popinText,demandPopin:e.demandPopin}}else{n.push(t)}});if(n.length){if(!this.isMultiSelect){this.columns[n[0]].first=true}this.columns[n[n.length-1]].last=true}if(this._hiddenColumns.length!==i.length){this._hiddenColumns=i;if(i.length){this.fireEvent("popin-change",{poppedColumns:this._hiddenColumns})}}}getColumnPropagationSettings(){return this.columns.map((e,t)=>({index:t,minWidth:e.minWidth,demandPopin:e.demandPopin,text:e.textContent,popinText:e.popinText,visible:!this._hiddenColumns[t]}),this)}getIntersectionObserver(){if(!this.growingIntersectionObserver){this.growingIntersectionObserver=new IntersectionObserver(this.onInteresection.bind(this),{root:document,rootMargin:"0px",threshold:1})}return this.growingIntersectionObserver}get styles(){return{busy:{position:this.busyIndPosition}}}get growsWithButton(){return this.growing===g.default.Button}get growsOnScroll(){return this.growing===g.default.Scroll}get _growingButtonText(){return this.growingButtonText||T.i18nBundle.getText(_.LOAD_MORE_TEXT)}get ariaLabelText(){const e=T.i18nBundle.getText(_.TABLE_HEADER_ROW_TEXT);const t=this.columns.map(e=>e.textContent.trim()).join(" ");return`${e} ${t}`}get tableAriaLabelText(){return(0,u.getEffectiveAriaLabelText)(this)}get ariaLabelSelectAllText(){return T.i18nBundle.getText(_.ARIA_LABEL_SELECT_ALL_CHECKBOX)}get loadMoreAriaLabelledBy(){if(this.moreDataText){return`${this._id}-growingButton-text ${this._id}-growingButton-subtext`}return`${this._id}-growingButton-text`}get tableEndDOM(){return this.shadowRoot.querySelector(".ui5-table-end-marker")}get busyIndPosition(){return this._inViewport?"absolute":"sticky"}get isMultiSelect(){return this.mode==="MultiSelect"}get selectedRows(){return this.rows.filter(e=>e.selected)}get currentItemIdx(){return this.rows.indexOf(this.currentItem)}get currentItem(){return this.getRootNode().activeElement}get currentElement(){return this._itemNavigation._getCurrentItem()}get columnHeaderTabbables(){return(0,c.getTabbableElements)(this.columnHeader)}get columnHeaderLastElement(){return(0,c.getLastTabbableElement)(this.columnHeader)}}T.define();var C=T;e.default=C});
//# sourceMappingURL=Table.js.map