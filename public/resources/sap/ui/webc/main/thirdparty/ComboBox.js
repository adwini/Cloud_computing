sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/util/InvisibleMessage","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/icons/not-editable","sap/ui/webc/common/thirdparty/icons/error","sap/ui/webc/common/thirdparty/icons/alert","sap/ui/webc/common/thirdparty/icons/sys-enter-2","sap/ui/webc/common/thirdparty/icons/information","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/Keys","./Filters","./generated/i18n/i18n-defaults","./generated/templates/ComboBoxTemplate.lit","./generated/templates/ComboBoxPopoverTemplate.lit","./generated/themes/ComboBox.css","./generated/themes/ComboBoxPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css","./ComboBoxItem","./Icon","./Popover","./ResponsivePopover","./List","./BusyIndicator","./Button","./StandardListItem","./ComboBoxGroupItem","./GroupHeaderListItem"],function(e,t,s,i,a,o,r,n,l,u,h,d,p,c,f,m,_,g,v,S,I,P,y,T,V,b,w,x,E,F,R,M,A,C,N,B,O){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=D(t);s=D(s);i=D(i);o=D(o);n=D(n);v=W(v);I=D(I);P=D(P);y=D(y);T=D(T);V=D(V);b=D(b);w=D(w);x=D(x);E=D(E);F=D(F);R=D(R);M=D(M);A=D(A);C=D(C);N=D(N);B=D(B);O=D(O);function L(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var s=new WeakMap;return(L=function(e){return e?s:t})(e)}function W(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var s=L(t);if(s&&s.has(e)){return s.get(e)}var i={};var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var r=a?Object.getOwnPropertyDescriptor(e,o):null;if(r&&(r.get||r.set)){Object.defineProperty(i,o,r)}else{i[o]=e[o]}}}i.default=e;if(s){s.set(e,i)}return i}function D(e){return e&&e.__esModule?e:{default:e}}const G={tag:"ui5-combobox",languageAware:true,properties:{value:{type:String,defaultValue:""},filterValue:{type:String,defaultValue:""},placeholder:{type:String,defaultValue:""},disabled:{type:Boolean},valueState:{type:i.default,defaultValue:i.default.None},readonly:{type:Boolean},required:{type:Boolean},loading:{type:Boolean},filter:{type:String,defaultValue:"StartsWithPerTerm"},focused:{type:Boolean},_isValueStateFocused:{type:Boolean},accessibleName:{type:String,defaultValue:undefined},accessibleNameRef:{type:String,defaultValue:""},_iconPressed:{type:Boolean,noAttribute:true},_filteredItems:{type:Object},_listWidth:{type:o.default,defaultValue:0,noAttribute:true}},managedSlots:true,slots:{default:{propertyName:"items",type:HTMLElement,invalidateOnChildChange:true},valueStateMessage:{type:HTMLElement},icon:{type:HTMLElement}},events:{change:{},input:{},"selection-change":{detail:{item:{type:HTMLElement}}}}};class U extends t.default{static get metadata(){return G}static get render(){return s.default}static get styles(){return y.default}static get staticAreaStyles(){return[V.default,b.default,T.default,w.default]}static get template(){return I.default}static get staticAreaTemplate(){return P.default}constructor(e){super(e);this._filteredItems=[];this._initialRendering=true;this._itemFocused=false;this._selectionChanged=false;this.FormSupport=undefined}onBeforeRendering(){this.FormSupport=(0,_.getFeature)("FormSupport");if(this._initialRendering){this._filteredItems=this.items}if(!this._initialRendering&&this.popover&&document.activeElement===this&&!this._filteredItems.length){this.popover.close()}this._selectMatchingItem();this._initialRendering=false}async onAfterRendering(){await this._respPopover();if((0,a.isPhone)()&&this.responsivePopover.opened){this.inner.focus()}if(this.shouldClosePopover()&&!(0,a.isPhone)()){this.responsivePopover.close(false,false,true);this._clearFocus();this._itemFocused=false}this.toggleValueStatePopover(this.shouldOpenValueStateMessagePopover);this.storeResponsivePopoverWidth();if((0,a.isSafari)()&&this._autocomplete&&this.filterValue!==this.value){this.inner.setSelectionRange(this._isKeyNavigation?0:this.filterValue.length,this.value.length)}}shouldClosePopover(){return this.responsivePopover.opened&&!this.focused&&!this._itemFocused&&!this._isValueStateFocused}_focusin(e){this.focused=true;this._lastValue=this.value;this._autocomplete=false;!(0,a.isPhone)()&&e.target.setSelectionRange(0,this.value.length)}_focusout(e){const t=e.relatedTarget&&e.relatedTarget.shadowRoot&&e.relatedTarget.shadowRoot.querySelector(".ui5-valuestatemessage-root");this._fireChangeEvent();if(t){e.stopImmediatePropagation();return}if(!this.shadowRoot.contains(e.relatedTarget)&&this.staticAreaItem!==e.relatedTarget){this.focused=false;!(0,a.isPhone)()&&this._closeRespPopover(e)}}_afterOpenPopover(){this._iconPressed=true}_afterClosePopover(){this._iconPressed=false;this._filteredItems=this.items;if((0,a.isPhone)()){this.blur()}if(this._selectionPerformed){this._lastValue=this.value;this._selectionPerformed=false}}_toggleRespPopover(){if(this.responsivePopover.opened){this._closeRespPopover()}else{this._openRespPopover()}}storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=this.responsivePopover.offsetWidth}}toggleValueStatePopover(e){if(e){this.openValueStatePopover()}else{this.closeValueStatePopover()}}async openValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.showAt(this)}async closeValueStatePopover(){this.popover=await this._getPopover();this.popover&&this.popover.close()}async _getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector(".ui5-valuestatemessage-popover")}_resetFilter(){this._userTypedValue=null;this.inner.setSelectionRange(0,this.value.length);this._filteredItems=this._filterItems("");this._selectMatchingItem()}_arrowClick(){this.inner.focus();this._resetFilter();this._toggleRespPopover()}_input(e){const{value:t}=e.target;if(e.target===this.inner){e.stopImmediatePropagation();this.focused=true;this._isValueStateFocused=false}this._filteredItems=this._filterItems(t);this.value=t;this.filterValue=t;this._clearFocus();if(this._autocomplete&&!(0,a.isAndroid)()){const e=this._getFirstMatchingItem(t);this._applyAtomicValueAndSelection(e,t,true);if(t!==""&&!this._selectionChanged&&e&&!e.selected&&!e.isGroupItem){this.fireEvent("selection-change",{item:e});this._selectionChanged=false}}this.fireEvent("input");if((0,a.isPhone)()){return}if(!this._filteredItems.length||t===""){this._closeRespPopover()}else{this._openRespPopover()}}_startsWithMatchingItems(e){return v.StartsWith(e,this._filteredItems,"text")}_clearFocus(){this._filteredItems.map(e=>{e.focused=false;return e})}handleNavKeyPress(e){if(this.focused&&((0,g.isHome)(e)||(0,g.isEnd)(e))&&this.value){return}const t=this.open;const s=this._filteredItems.find(e=>t?e.focused:e.selected);const i=this._filteredItems.indexOf(s);e.preventDefault();if(this.focused&&t&&((0,g.isUp)(e)||(0,g.isPageUp)(e)||(0,g.isPageDown)(e))){return}if(this._filteredItems.length-1===i&&(0,g.isDown)(e)){return}this._isKeyNavigation=true;this[`_handle${e.key}`](e,i)}_handleItemNavigation(e,t,s){const i=this.open;const a=this._filteredItems[t];const o=s?this._filteredItems[t+1]:this._filteredItems[t-1];const r=a&&a.isGroupItem;if(!i&&(r&&!o||!r&&!a)){return}this._clearFocus();if(i){this._itemFocused=true;this.value=r?"":a.text;this.focused=false;a.focused=true}else{this.focused=true;this.value=r?o.text:a.text;a.focused=false}this._isValueStateFocused=false;this._selectionChanged=true;if(r&&i){return}this._announceSelectedItem(t);const n=this._getFirstMatchingItem(this.value);this._applyAtomicValueAndSelection(n,this.open?this._userTypedValue:null,true);if(n&&!n.selected){this.fireEvent("selection-change",{item:n})}this.fireEvent("input");this._fireChangeEvent()}_handleArrowDown(e,t){const s=this.open;if(this.focused&&t===-1&&this.hasValueStateText&&s){this._isValueStateFocused=true;this.focused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,++t,true)}_handleArrowUp(e,t){const s=this.open;if(t===0&&!this.hasValueStateText){this._clearFocus();this.focused=true;this._itemFocused=false;return}if(t===0&&this.hasValueStateText&&s){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;this._filteredItems[0].selected=false;return}if(this._isValueStateFocused){this.focused=true;this._isValueStateFocused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,--t,false)}_handlePageUp(e,t){const s=t-U.SKIP_ITEMS_SIZE>-1;t=s?t-U.SKIP_ITEMS_SIZE:0;const i=this._filteredItems[t].isGroupItem&&!this.open;if(!s&&this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,t,i)}_handlePageDown(e,t){const s=this._filteredItems.length;const i=t+U.SKIP_ITEMS_SIZE<s;t=i?t+U.SKIP_ITEMS_SIZE:s-1;const a=this._filteredItems[t].isGroupItem&&!this.open;this._handleItemNavigation(e,t,a)}_handleHome(e,t){const s=this._filteredItems[0].isGroupItem&&!this.open;if(this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,t=0,s)}_handleEnd(e,t){this._handleItemNavigation(e,t=this._filteredItems.length-1,true)}_keyup(e){this._userTypedValue=this.value.substring(0,this.inner.selectionStart)}_keydown(e){const t=(0,g.isDown)(e)||(0,g.isUp)(e)||(0,g.isPageUp)(e)||(0,g.isPageDown)(e)||(0,g.isHome)(e)||(0,g.isEnd)(e);this._autocomplete=!((0,g.isBackSpace)(e)||(0,g.isDelete)(e));this._isKeyNavigation=false;if(t&&!this.readonly&&this._filteredItems.length){this.handleNavKeyPress(e)}if((0,g.isEnter)(e)){this._fireChangeEvent();if(this.responsivePopover.opened){this._closeRespPopover();this.focused=true}else if(this.FormSupport){this.FormSupport.triggerFormSubmit(this)}}if((0,g.isEscape)(e)){this.focused=true;this.value=!this.open?this._lastValue:this.value;this._isValueStateFocused=false}if(((0,g.isTabNext)(e)||(0,g.isTabPrevious)(e))&&this.open){this._closeRespPopover()}if((0,g.isShow)(e)&&!this.readonly&&!this.disabled){e.preventDefault();this._resetFilter();this._toggleRespPopover();const t=this._filteredItems.find(e=>e.selected);if(t&&this.open){this._itemFocused=true;t.focused=true;this.focused=false}else if(this.open&&this._filteredItems.length){this._handleItemNavigation(e,0,true)}else{this.focused=true}}}_click(e){if((0,a.isPhone)()&&!this.readonly){this._openRespPopover()}}_closeRespPopover(e){if((0,a.isPhone)()&&e&&e.target.classList.contains("ui5-responsive-popover-close-btn")&&this._selectedItemText){this.value=this._selectedItemText;this.filterValue=this._selectedItemText}this._isValueStateFocused=false;this._clearFocus();this.responsivePopover.close()}_openRespPopover(){this.responsivePopover.showAt(this)}_filterItems(e){const t=this.items.filter(e=>!e.isGroupItem);const s=(v[this.filter]||v.StartsWithPerTerm)(e,t,"text");return this.items.filter((e,t,i)=>U._groupItemFilter(e,++t,i,s)||s.indexOf(e)!==-1)}static _groupItemFilter(e,t,s,i){if(e.isGroupItem){let e;while(s[t]&&!s[t].isGroupItem&&!e){e=i.indexOf(s[t])!==-1;t++}return e}}_getFirstMatchingItem(e){const t=this.items.find(e=>e.focused===true);if(t&&t.isGroupItem){this.value=this.filterValue;return}const s=this._startsWithMatchingItems(e).filter(e=>!e.isGroupItem);if(s.length){return s[0]}}_applyAtomicValueAndSelection(e,t,s){if(!e){return}const i=e&&e.text||"";this.inner.value=i;if(s){t=t||"";this.inner.setSelectionRange(t.length,i.length)}this.value=i}_selectMatchingItem(){const e=this.items.find(e=>e.focused);const t=e&&e.isGroupItem;this._filteredItems=this._filteredItems.map(e=>{e.selected=!e.isGroupItem&&e.text===this.value&&!t;return e})}_fireChangeEvent(){if(this.value!==this._lastValue){this.fireEvent("change");this._lastValue=this.value}}_inputChange(e){e.preventDefault()}_itemMousedown(e){e.preventDefault()}_selectItem(e){const t=e.detail.item;this._selectedItemText=t.mappedItem.text;this._selectionPerformed=true;const s=this.value===this._selectedItemText;const i=this.value.toLowerCase()===this.filterValue.toLowerCase();if(s&&i){this._fireChangeEvent();return this._closeRespPopover()}this.value=this._selectedItemText;if(!t.mappedItem.selected){this.fireEvent("selection-change",{item:t.mappedItem});this._selectionChanged=true}this._filteredItems.map(e=>{e.selected=e===t.mappedItem&&!e.isGroupItem;return e});this._fireChangeEvent();this._closeRespPopover();this.inner.setSelectionRange(this.value.length,this.value.length)}_onItemFocus(e){this._itemFocused=true}_announceSelectedItem(e){const t=U.i18nBundle.getText(S.LIST_ITEM_POSITION,e+1,this._filteredItems.length);const s=U.i18nBundle.getText(S.LIST_ITEM_SELECTED);(0,n.default)(`${t} ${s}`,"Polite")}get _headerTitleText(){return U.i18nBundle.getText(S.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return U.i18nBundle.getText(S.SELECT_OPTIONS)}get inner(){return(0,a.isPhone)()?this.responsivePopover.querySelector(".ui5-input-inner-phone"):this.shadowRoot.querySelector("[inner-input]")}async _respPopover(){const e=await this.getStaticAreaItemDomRef();this.responsivePopover=e.querySelector("[ui5-responsive-popover]");return this.responsivePopover}get editable(){return!this.readonly}get hasValueState(){return this.valueState!==i.default.None}get hasValueStateText(){return this.hasValueState&&this.valueState!==i.default.Success}get valueStateText(){return this.valueStateTextMappings[this.valueState]}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get valueStateTextId(){return this.hasValueState?`${this._id}-valueStateDesc`:undefined}get valueStateTextMappings(){return{Success:U.i18nBundle.getText(S.VALUE_STATE_SUCCESS),Error:U.i18nBundle.getText(S.VALUE_STATE_ERROR),Warning:U.i18nBundle.getText(S.VALUE_STATE_WARNING),Information:U.i18nBundle.getText(S.VALUE_STATE_INFORMATION)}}get shouldOpenValueStateMessagePopover(){return this.focused&&!this.readonly&&this.hasValueStateText&&!this._iconPressed&&!this.open&&!this._isPhone}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateText}get _valueStatePopoverHorizontalAlign(){return this.effectiveDir!=="rtl"?"Left":"Right"}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==i.default.None?e[this.valueState]:""}get open(){return this.responsivePopover?this.responsivePopover.opened:false}get _isPhone(){return(0,a.isPhone)()}get itemTabIndex(){return undefined}get ariaLabelText(){return(0,r.getEffectiveAriaLabelText)(this)}static get dependencies(){return[x.default,E.default,R.default,M.default,A.default,C.default,N.default,O.default,F.default,B.default]}static async onDefine(){U.i18nBundle=await(0,m.getI18nBundle)("@ui5/webcomponents")}get styles(){const e=parseInt(getComputedStyle(document.documentElement).fontSize);return{popoverHeader:{width:`${this.offsetWidth}px`},suggestionPopoverHeader:{display:this._listWidth===0?"none":"inline-block",width:`${this._listWidth}px`},suggestionsPopover:{"min-width":`${this.offsetWidth}px`,"max-width":this.offsetWidth/e>40?`${this.offsetWidth}px`:"40rem"}}}get classes(){return{popover:{"ui5-suggestions-popover":!this.isPhone,"ui5-suggestions-popover-with-value-state-header":!this.isPhone&&this.hasValueStateText},popoverValueState:{"ui5-valuestatemessage-header":true,"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===i.default.Success,"ui5-valuestatemessage--error":this.valueState===i.default.Error,"ui5-valuestatemessage--warning":this.valueState===i.default.Warning,"ui5-valuestatemessage--information":this.valueState===i.default.Information}}}}U.SKIP_ITEMS_SIZE=10;U.define();var H=U;e.default=H});
//# sourceMappingURL=ComboBox.js.map