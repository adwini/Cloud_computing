sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/delegate/ScrollEnablement","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/ValueState","./ResponsivePopover","./List","./Title","./Button","./StandardListItem","./generated/templates/TokenizerTemplate.lit","./generated/templates/TokenizerPopoverTemplate.lit","./generated/i18n/i18n-defaults","./generated/themes/Tokenizer.css","./generated/themes/TokenizerPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css"],function(e,t,n,s,i,o,r,a,l,h,u,d,c,f,g,p,m,_,v,S,k,T,w,E){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=y(t);n=y(n);s=y(s);i=y(i);o=y(o);r=y(r);u=y(u);d=y(d);c=y(c);f=y(f);g=y(g);p=y(p);m=y(m);_=y(_);S=y(S);k=y(k);T=y(T);w=y(w);E=y(E);function y(e){return e&&e.__esModule?e:{default:e}}const b={tag:"ui5-tokenizer",languageAware:true,managedSlots:true,slots:{default:{propertyName:"tokens",type:HTMLElement,individualSlots:true},valueStateMessage:{propertyName:"valueStateMessage",type:HTMLElement}},properties:{showMore:{type:Boolean},disabled:{type:Boolean},expanded:{type:Boolean},morePopoverOpener:{type:Object},popoverMinWidth:{type:r.default},valueState:{type:u.default,defaultValue:u.default.None},_nMoreCount:{type:r.default}},events:{"token-delete":{detail:{ref:{type:HTMLElement}}},"show-more-items-press":{detail:{ref:{type:HTMLElement}}}}};class N extends t.default{static get metadata(){return b}static get render(){return n.default}static get template(){return m.default}static get styles(){return S.default}static get staticAreaStyles(){return[T.default,w.default,E.default,k.default]}static get staticAreaTemplate(){return _.default}_handleResize(){this._nMoreCount=this.overflownTokens.length}constructor(){super();this._resizeHandler=this._handleResize.bind(this);this._itemNav=new i.default(this,{currentIndex:"-1",getItemsCallback:this._getVisibleTokens.bind(this)});this._scrollEnablement=new o.default(this)}async onBeforeRendering(){if(this.showPopover&&!this._getTokens().length){const e=await this.getPopover();e.close()}this._nMoreCount=this.overflownTokens.length}onEnterDOM(){s.default.register(this.shadowRoot.querySelector(".ui5-tokenizer--content"),this._resizeHandler)}onExitDOM(){s.default.deregister(this.shadowRoot.querySelector(".ui5-tokenizer--content"),this._resizeHandler)}async _openOverflowPopover(){if(this.showPopover){const e=await this.getPopover();e.showAt(this.morePopoverOpener||this)}this.fireEvent("show-more-items-press")}_getTokens(){return this.getSlottedNodes("tokens")}get _tokens(){return this.getSlottedNodes("tokens")}get showPopover(){return Object.keys(this.morePopoverOpener).length}_getVisibleTokens(){if(this.disabled){return[]}return this._tokens.filter((e,t)=>t<this._tokens.length-this._nMoreCount)}onAfterRendering(){this._scrollEnablement.scrollContainer=this.expanded?this.contentDom:this}_delete(e){if(this._selectedTokens.length){this._selectedTokens.forEach(t=>this._tokenDelete(e,t))}else{this._tokenDelete(e)}}_tokenDelete(e,t){let n;const s=this._getVisibleTokens();const i=t?s.indexOf(t):s.indexOf(e.target);const o=s.filter(e=>!e.selected);if(e.detail&&e.detail.backSpace){n=i===0?i+1:i-1}else{n=i===s.length-1?i-1:i+1}let r=s[n];if(o.length>1){while(r&&r.selected){r=e.detail.backSpace?s[--n]:s[++n]}}else{r=o[0]}if(r&&!(0,h.isPhone)()){this._itemNav.setCurrentItem(r);setTimeout(()=>{r.focus()},0)}this.fireEvent("token-delete",{ref:t||e.target})}itemDelete(e){const t=e.detail.item.tokenRef;this.fireEvent("token-delete",{ref:t})}_onkeydown(e){if((0,l.isSpaceShift)(e)){e.preventDefault()}if((0,l.isSpace)(e)||(0,l.isSpaceCtrl)(e)){e.preventDefault();return this._handleTokenSelection(e,false)}if((0,l.isHomeShift)(e)){this._handleHomeShift(e)}if((0,l.isEndShift)(e)){this._handleEndShift(e)}this._handleItemNavigation(e,this._tokens)}_handleItemNavigation(e,t){const n=!!(e.metaKey||e.ctrlKey);if((0,l.isLeftCtrl)(e)||(0,l.isRightCtrl)(e)||(0,l.isDownCtrl)(e)||(0,l.isUpCtrl)(e)){return this._handleArrowCtrl(e,e.target,t,(0,l.isRightCtrl)(e)||(0,l.isDownCtrl)(e))}if((0,l.isLeftShift)(e)||(0,l.isRightShift)(e)||(0,l.isUpShift)(e)||(0,l.isDownShift)(e)||(0,l.isLeftShiftCtrl)(e)||(0,l.isRightShiftCtrl)(e)){e.preventDefault();return this._handleArrowShift(e.target,t,(0,l.isRightShift)(e)||(0,l.isRightShiftCtrl)(e)||(0,l.isDownShift)(e))}if((0,l.isHome)(e)||(0,l.isEnd)(e)||(0,l.isHomeCtrl)(e)||(0,l.isEndCtrl)(e)){e.preventDefault();return this._handleHome(t,(0,l.isEnd)(e)||(0,l.isEndCtrl)(e))}if(n&&e.key.toLowerCase()==="a"){e.preventDefault();return this._toggleTokenSelection(t)}}_handleHome(e,t){if(!e||!e.length){return-1}const n=t?e.length-1:0;e[n].focus();this._itemNav.setCurrentItem(e[n])}_handleHomeShift(e){const t=this.tokens;const n=t.indexOf(e.target);t.filter((e,t)=>t<=n).forEach(e=>{e.selected=true});t[0].focus();this._itemNav.setCurrentItem(t[0])}_handleEndShift(e){const t=this.tokens;const n=t.indexOf(e.target);t.filter((e,t)=>t>=n).forEach(e=>{e.selected=true});t[t.length-1].focus();this._itemNav.setCurrentItem(t[t.length-1])}_calcNextTokenIndex(e,t,n){if(!t.length){return-1}const s=t.indexOf(e);let i=n?s+1:s-1;if(i>=t.length){i=t.length-1}if(i<0){i=0}return i}_handleArrowCtrl(e,t,n,s){const i=this._calcNextTokenIndex(t,n,s);e.preventDefault();if(i===-1){return}setTimeout(()=>n[i].focus(),0);this._itemNav.setCurrentItem(n[i])}_handleArrowShift(e,t,n){const s=t.indexOf(e);const i=n?s+1:s-1;if(i===-1||i===t.length){return}e.selected=true;t[i].selected=true;setTimeout(()=>t[i].focus(),0);this._itemNav.setCurrentItem(t[i])}_click(e){this._handleTokenSelection(e)}_onmousedown(e){this._itemNav.setCurrentItem(e.target)}_toggleTokenSelection(e){if(!e||!e.length){return}const t=e.every(e=>e.selected);e.forEach(e=>{e.selected=!t})}_handleTokenSelection(e,t=true){if(e.target.hasAttribute("ui5-token")){const n=t?this._tokens:[e.target];n.forEach(t=>{if(t!==e.target){t.selected=false}})}}_fillClipboard(e,t){const n=t.filter(e=>e.selected).map(e=>e.text).join("\r\n");const s=e=>{if(e.clipboardData){e.clipboardData.setData("text/plain",n)}else{e.originalEvent.clipboardData.setData("text/plain",n)}e.preventDefault()};document.addEventListener(e,s);document.execCommand(e);document.removeEventListener(e,s)}scrollToStart(){this.contentDom.scrollLeft=0}async closeMorePopover(){const e=await this.getPopover();e.close()}get _nMoreText(){return N.i18nBundle.getText(v.MULTIINPUT_SHOW_MORE_TOKENS,this._nMoreCount)}get showNMore(){return!this.expanded&&this.showMore&&this.overflownTokens.length}get contentDom(){return this.shadowRoot.querySelector(".ui5-tokenizer--content")}get tokenizerLabel(){return N.i18nBundle.getText(v.TOKENIZER_ARIA_LABEL)}get morePopoverTitle(){return N.i18nBundle.getText(v.TOKENIZER_POPOVER_REMOVE)}get overflownTokens(){if(!this.contentDom){return[]}this._getTokens().forEach(e=>{e.overflows=false});return this._getTokens().filter(e=>{const t=this.effectiveDir==="rtl";const n=t?"left":"right";const s=this.contentDom.getBoundingClientRect();const i=e.getBoundingClientRect();const o=parseInt(i[n]);const r=parseInt(s[n]);e.overflows=t?o<r&&!this.expanded:o>r&&!this.expanded;return e.overflows})}get hasValueState(){return this.valueState===u.default.None||this.valueState===u.default.Success}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==u.default.None?e[this.valueState]:""}get _isPhone(){return(0,h.isPhone)()}get _selectedTokens(){return this._getTokens().filter(e=>e.selected)}get classes(){return{wrapper:{"ui5-tokenizer-root":true,"ui5-tokenizer-nmore--wrapper":this.showMore,"ui5-tokenizer-no-padding":!this._getTokens().length},content:{"ui5-tokenizer--content":true,"ui5-tokenizer-nmore--content":this.showMore},popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-responsive-popover-header":this.showPopover,"ui5-valuestatemessage--success":this.valueState===u.default.Success,"ui5-valuestatemessage--error":this.valueState===u.default.Error,"ui5-valuestatemessage--warning":this.valueState===u.default.Warning,"ui5-valuestatemessage--information":this.valueState===u.default.Information}}}get styles(){return{popover:{"min-width":`${this.popoverMinWidth}px`},popoverValueStateMessage:{width:(0,h.isPhone)()?"100%":`${this.popoverMinWidth}px`,"min-height":"2rem"},popoverHeader:{"min-height":"2rem"},popoverHeaderTitle:{"justify-content":"left"}}}_tokensCountText(){const e=this._getTokens().length;if(e===0){return N.i18nBundle.getText(v.TOKENIZER_ARIA_CONTAIN_TOKEN)}if(e===1){return N.i18nBundle.getText(v.TOKENIZER_ARIA_CONTAIN_ONE_TOKEN)}return N.i18nBundle.getText(v.TOKENIZER_ARIA_CONTAIN_SEVERAL_TOKENS,e)}_focusLastToken(){if(this.tokens.length===0){return}const e=this.tokens[this.tokens.length-1];e.focus();this._itemNav.setCurrentItem(e)}static get dependencies(){return[d.default,c.default,p.default,f.default,g.default]}static async onDefine(){N.i18nBundle=await(0,a.getI18nBundle)("@ui5/webcomponents")}async getPopover(){return(await this.getStaticAreaItemDomRef()).querySelector("[ui5-responsive-popover]")}}N.define();var C=N;e.default=C});
//# sourceMappingURL=Tokenizer.js.map