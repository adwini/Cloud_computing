sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/util/PopupUtils","sap/ui/webc/common/thirdparty/base/util/clamp","./Popup","./types/PopoverPlacementType","./types/PopoverVerticalAlign","./types/PopoverHorizontalAlign","./popup-utils/PopoverRegistry","./generated/templates/PopoverTemplate.lit","./generated/themes/BrowserScrollbar.css","./generated/themes/PopupsCommon.css","./generated/themes/Popover.css"],function(t,e,i,o,a,r,s,l,n,h,d,u,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;e=f(e);a=f(a);r=f(r);s=f(s);l=f(l);n=f(n);d=f(d);u=f(u);p=f(p);c=f(c);function f(t){return t&&t.__esModule?t:{default:t}}const g=8;const m={tag:"ui5-popover",properties:{headerText:{type:String},placementType:{type:s.default,defaultValue:s.default.Right},horizontalAlign:{type:n.default,defaultValue:n.default.Center},verticalAlign:{type:l.default,defaultValue:l.default.Center},modal:{type:Boolean},hideBackdrop:{type:Boolean},hideArrow:{type:Boolean},allowTargetOverlap:{type:Boolean},opener:{type:String},disableScrolling:{type:Boolean},arrowTranslateX:{type:e.default,defaultValue:0,noAttribute:true},arrowTranslateY:{type:e.default,defaultValue:0,noAttribute:true},actualPlacementType:{type:s.default,defaultValue:s.default.Right},_maxHeight:{type:e.default,noAttribute:true},_maxWidth:{type:e.default,noAttribute:true}},managedSlots:true,slots:{header:{type:HTMLElement},footer:{type:HTMLElement}},events:{}};class w extends r.default{constructor(){super()}static get metadata(){return m}static get styles(){return[u.default,p.default,c.default]}static get template(){return d.default}static get VIEWPORT_MARGIN(){return 10}onAfterRendering(){if(!this.isOpen()&&this.open){const t=document.getElementById(this.opener);if(!t){console.warn("Valid opener id is required.");return}this.showAt(t)}else if(this.isOpen()&&!this.open){this.close()}}isOpenerClicked(t){const e=t.target;return e===this._opener||e.getFocusDomRef&&e.getFocusDomRef()===this._opener||t.composedPath().indexOf(this._opener)>-1}async showAt(t,e=false){if(!t||this.opened){return}this._opener=t;this._openerRect=t.getBoundingClientRect();await super._open(e)}_addOpenedPopup(){(0,h.addOpenedPopover)(this)}_removeOpenedPopup(){(0,h.removeOpenedPopover)(this)}shouldCloseDueToOverflow(t,e){const i=32;const a={Right:e.right,Left:e.left,Top:e.top,Bottom:e.bottom};const r=(0,o.getClosedPopupParent)(this._opener);let s=false;let l=false;if(r.showAt){const t=r.contentDOM.getBoundingClientRect();s=e.top>t.top+t.height;l=e.top+e.height<t.top}return a[t]<0||a[t]+i>r.innerHeight||s||l}shouldCloseDueToNoOpener(t){return t.top===0&&t.bottom===0&&t.left===0&&t.right===0}isOpenerOutsideViewport(t){return t.bottom<0||t.top>window.innerHeight||t.right<0||t.left>window.innerWidth}_resize(){super._resize();if(this.opened){this.reposition()}}reposition(){this._show()}_show(){let t;const e=this.getPopoverSize();if(e.width===0||e.height===0){return}if(this.isOpen()){this._openerRect=this._opener.getBoundingClientRect()}if(this.shouldCloseDueToNoOpener(this._openerRect)&&this.isFocusWithin()){t=this._oldPlacement}else{t=this.calcPlacement(this._openerRect,e)}const i=this.horizontalAlign===n.default.Stretch;if(this._preventRepositionAndClose||this.isOpenerOutsideViewport(this._openerRect)){return this.close()}this._oldPlacement=t;this.actualPlacementType=t.placementType;let o=(0,a.default)(this._left,w.VIEWPORT_MARGIN,document.documentElement.clientWidth-e.width-w.VIEWPORT_MARGIN);if(this.actualPlacementType===s.default.Right){o=Math.max(o,this._left)}let r=(0,a.default)(this._top,w.VIEWPORT_MARGIN,document.documentElement.clientHeight-e.height-w.VIEWPORT_MARGIN);if(this.actualPlacementType===s.default.Bottom){r=Math.max(r,this._top)}this.arrowTranslateX=t.arrow.x;this.arrowTranslateY=t.arrow.y;r=this._adjustForIOSKeyboard(r);Object.assign(this.style,{top:`${r}px`,left:`${o}px`});super._show();if(i&&this._width){this.style.width=this._width}}_adjustForIOSKeyboard(t){if(!(0,i.isIOS)()){return t}const e=Math.ceil(this.getBoundingClientRect().top);return t+(Number.parseInt(this.style.top||"0")-e)}getPopoverSize(){if(!this.opened){Object.assign(this.style,{display:"block",top:"-10000px",left:"-10000px"})}const t=this.getBoundingClientRect(),e=t.width,i=t.height;return{width:e,height:i}}get arrowDOM(){return this.shadowRoot.querySelector(".ui5-popover-arrow")}calcPlacement(t,e){let i=0;let o=0;const a=this.allowTargetOverlap;const r=document.documentElement.clientWidth;const h=document.documentElement.clientHeight;let d=h;let u=r;const p=this.getActualPlacementType(t,e);this._preventRepositionAndClose=this.shouldCloseDueToNoOpener(t)||this.shouldCloseDueToOverflow(p,t);const c=p===s.default.Top||p===s.default.Bottom;if(this.horizontalAlign===n.default.Stretch&&c){e.width=t.width;this._width=`${t.width}px`}else if(this.verticalAlign===l.default.Stretch&&!c){e.height=t.height}const f=this.hideArrow?0:g;switch(p){case s.default.Top:i=this.getVerticalLeft(t,e);o=Math.max(t.top-e.height-f,0);if(!a){d=t.top-f}break;case s.default.Bottom:i=this.getVerticalLeft(t,e);o=t.bottom+f;if(a){o=Math.max(Math.min(o,h-e.height),0)}else{d=h-t.bottom-f}break;case s.default.Left:i=Math.max(t.left-e.width-f,0);o=this.getHorizontalTop(t,e);if(!a){u=t.left-f}break;case s.default.Right:i=t.left+t.width+f;o=this.getHorizontalTop(t,e);if(a){i=Math.max(Math.min(i,r-e.width),0)}else{u=r-t.right-f}break}if(c){if(e.width>r||i<0){i=0}else if(i+e.width>r){i-=i+e.width-r}}else{if(e.height>h||o<0){o=0}else if(o+e.height>h){o-=o+e.height-h}}this._maxHeight=Math.round(d-w.VIEWPORT_MARGIN);this._maxWidth=Math.round(u-w.VIEWPORT_MARGIN);if(this._left===undefined||Math.abs(this._left-i)>1.5){this._left=Math.round(i)}if(this._top===undefined||Math.abs(this._top-o)>1.5){this._top=Math.round(o)}const m=Number.parseInt(window.getComputedStyle(this).getPropertyValue("border-radius"));const _=this.getArrowPosition(t,e,i,o,c,m);return{arrow:_,top:this._top,left:this._left,placementType:p}}getArrowPosition(t,{width:e,height:i},o,r,s,l){let h=this.horizontalAlign===n.default.Center||this.horizontalAlign===n.default.Stretch;if(this.horizontalAlign===n.default.Right&&o<=t.left){h=true}if(this.horizontalAlign===n.default.Left&&o+e>=t.left+t.width){h=true}let d=0;if(s&&h){d=t.left+t.width/2-o-e/2}let u=0;if(!s){u=t.top+t.height/2-r-i/2}const p=i/2-l-g/2;u=(0,a.default)(u,-p,p);const c=e/2-l-g/2;d=(0,a.default)(d,-c,c);return{x:Math.round(d),y:Math.round(u)}}fallbackPlacement(t,e,i,o){if(i.left>o.width){return s.default.Left}if(t-i.right>i.left){return s.default.Right}if(e-i.bottom>o.height){return s.default.Bottom}if(e-i.bottom<i.top){return s.default.Top}}getActualPlacementType(t,e){const i=this.placementType;let o=i;const a=document.documentElement.clientWidth;const r=document.documentElement.clientHeight;switch(i){case s.default.Top:if(t.top<e.height&&t.top<r-t.bottom){o=s.default.Bottom}break;case s.default.Bottom:if(r-t.bottom<e.height&&r-t.bottom<t.top){o=s.default.Top}break;case s.default.Left:if(t.left<e.width){o=this.fallbackPlacement(a,r,t,e)||i}break;case s.default.Right:if(a-t.right<e.width){o=this.fallbackPlacement(a,r,t,e)||i}break}return o}getVerticalLeft(t,e){let i;switch(this.horizontalAlign){case n.default.Center:case n.default.Stretch:i=t.left-(e.width-t.width)/2;break;case n.default.Left:i=t.left;break;case n.default.Right:i=t.right-e.width;break}return i}getHorizontalTop(t,e){let i;switch(this.verticalAlign){case l.default.Center:case l.default.Stretch:i=t.top-(e.height-t.height)/2;break;case l.default.Top:i=t.top;break;case l.default.Bottom:i=t.bottom-e.height;break}return i}get isModal(){return this.modal}get shouldHideBackdrop(){return this.hideBackdrop}get _ariaLabelledBy(){if(!this._ariaLabel&&this._displayHeader){return"ui5-popup-header"}return undefined}get _ariaModal(){return true}get styles(){return{...super.styles,root:{"max-height":`${this._maxHeight}px`,"max-width":`${this._maxWidth}px`},arrow:{transform:`translate(${this.arrowTranslateX}px, ${this.arrowTranslateY}px)`}}}get classes(){const t=super.classes;t.root["ui5-popover-root"]=true;return t}get _displayHeader(){return this.header.length||this.headerText}get _displayFooter(){return true}}w.define();var _=w;t.default=_});
//# sourceMappingURL=Popover.js.map