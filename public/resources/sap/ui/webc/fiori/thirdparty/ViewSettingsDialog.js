sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/main/thirdparty/Dialog","sap/ui/webc/main/thirdparty/Button","sap/ui/webc/main/thirdparty/Label","sap/ui/webc/main/thirdparty/GroupHeaderListItem","sap/ui/webc/main/thirdparty/List","sap/ui/webc/main/thirdparty/StandardListItem","sap/ui/webc/main/thirdparty/Title","sap/ui/webc/main/thirdparty/SegmentedButton","sap/ui/webc/main/thirdparty/SegmentedButtonItem","./Bar","./types/ViewSettingsDialogMode","sap/ui/webc/common/thirdparty/icons/sort","sap/ui/webc/common/thirdparty/icons/filter","sap/ui/webc/common/thirdparty/icons/nav-back","./generated/i18n/i18n-defaults","./generated/templates/ViewSettingsDialogTemplate.lit","./generated/themes/ViewSettingsDialog.css"],function(t,e,i,s,r,n,l,o,d,a,u,c,g,h,f,_,S,p,y,m,O,B){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;s=b(s);r=b(r);n=b(n);l=b(l);o=b(o);d=b(d);a=b(a);u=b(u);c=b(c);g=b(g);h=b(h);f=b(f);_=b(_);O=b(O);B=b(B);function b(t){return t&&t.__esModule?t:{default:t}}const T={tag:"ui5-view-settings-dialog",managedSlots:true,properties:{sortDescending:{type:Boolean},_recentlyFocused:{type:Object},_initialSettings:{type:Object},_confirmedSettings:{type:Object},_currentSettings:{type:Object},_currentMode:{type:_.default,defaultValue:_.default.Sort},_filterStepTwo:{type:Boolean,noAttribute:true}},slots:{sortItems:{type:HTMLElement},filterItems:{type:HTMLElement}},events:{confirm:{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}},cancel:{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}},"before-open":{}}};class x extends r.default{constructor(){super();this._currentSettings={sortOrder:[],sortBy:[],filters:[]}}onBeforeRendering(){if(this._currentSettings.filters&&this._currentSettings.filters.length){this._setAdditionalTexts()}if(!this.shouldBuildSort&&this.shouldBuildFilter){this._currentMode=_.default.Filter}}_setAdditionalTexts(){this.filterItems.forEach((t,e)=>{let i=0;for(let s=0;s<t.values.length;s++){if(this._currentSettings.filters[e].filterOptions[s].selected){i++}}t.additionalText=!i?"":i})}static get render(){return s.default}static get metadata(){return T}static get dependencies(){return[f.default,l.default,c.default,n.default,o.default,a.default,u.default,d.default,g.default,h.default]}static get template(){return O.default}static get styles(){return B.default}static async onDefine(){x.i18nBundle=await(0,e.getI18nBundle)("@ui5/webcomponents-fiori")}get _selectedFilter(){for(let t=0;t<this._currentSettings.filters.length;t++){if(this._currentSettings.filters[t].selected){return this._currentSettings.filters[t]}}return""}get shouldBuildSort(){return!!this.sortItems.length}get shouldBuildFilter(){return!!this.filterItems.length}get hasPagination(){return this.shouldBuildSort&&this.shouldBuildFilter}get _filterByTitle(){return`${x.i18nBundle.getText(m.VSD_FILTER_BY)}: ${this._selectedFilter.text}`}get _dialogTitle(){return x.i18nBundle.getText(m.VSD_DIALOG_TITLE_SORT)}get _okButtonLabel(){return x.i18nBundle.getText(m.VSD_SUBMIT_BUTTON)}get _cancelButtonLabel(){return x.i18nBundle.getText(m.VSD_CANCEL_BUTTON)}get _resetButtonLabel(){return x.i18nBundle.getText(m.VSD_RESET_BUTTON)}get _ascendingLabel(){return x.i18nBundle.getText(m.VSD_ORDER_ASCENDING)}get _descendingLabel(){return x.i18nBundle.getText(m.VSD_ORDER_DESCENDING)}get _sortOrderLabel(){return x.i18nBundle.getText(m.VSD_SORT_ORDER)}get _filterByLabel(){return x.i18nBundle.getText(m.VSD_FILTER_BY)}get _sortByLabel(){return x.i18nBundle.getText(m.VSD_SORT_BY)}get _isPhone(){return(0,i.isPhone)()}get _sortAscending(){return!this.sortDescending}get _title(){return this.showBackButton?this._filterByTitle:this._dialogTitle}get _disableResetButton(){return this._dialog&&this._sortSetttingsAreInitial&&this._filteresAreInitial}get _sortSetttingsAreInitial(){let t=true;["sortBy","sortOrder"].forEach(e=>{this._currentSettings[e].forEach((i,s)=>{if(i.selected!==this._initialSettings[e][s].selected){t=false}})});return t}get _filteresAreInitial(){let t=true;this._currentSettings.filters.forEach((e,i)=>{for(let s=0;s<e.filterOptions.length;s++){if(e.filterOptions[s].selected!==this._initialSettings.filters[i].filterOptions[s].selected){t=false}}});return t}get _settings(){return{sortOrder:JSON.parse(JSON.stringify(this.initSortOrderItems)),sortBy:JSON.parse(JSON.stringify(this.initSortByItems)),filters:this.filterItems.map(t=>({text:t.text,selected:false,filterOptions:t.values.map(t=>({text:t.text,selected:t.selected}))}))}}get initSortByItems(){return this.sortItems.map((t,e)=>({text:t.text,selected:t.selected,index:e}))}get initSortOrderItems(){return[{text:this._ascendingLabel,selected:!this.sortDescending},{text:this._descendingLabel,selected:this.sortDescending}]}get expandContent(){return this._filterStepTwo||!this.hasPagination}get isModeSort(){return this._currentMode===_.default.Sort}get isModeFilter(){return this._currentMode===_.default.Filter}get showBackButton(){return this.isModeFilter&&this._filterStepTwo}get _sortOrderListDomRef(){return this.shadowRoot.querySelector("[ui5-list][sort-order]")}get _sortByList(){return this.shadowRoot.querySelector("[ui5-list][sort-by]")}get _dialogDomRef(){return this.shadowRoot.querySelector("[ui5-dialog]")}show(){if(!this._dialog){this._sortOrder=this._sortOrderListDomRef;this._sortBy=this._sortByList;this._initialSettings=this._settings;this._currentSettings=this._settings;this._confirmedSettings=this._settings;this._dialog=this._dialogDomRef}else{this._restoreSettings(this._confirmedSettings)}this.fireEvent("before-open",{},true,false);this._dialog.show(true);this._dialog.querySelector("[ui5-list]").focusFirstItem()}_handleModeChange(t){this._currentMode=_.default[t.detail.selectedItem.getAttribute("mode")]}_handleFilterValueItemClick(t){this._currentSettings.filters=this._currentSettings.filters.map(e=>{if(e.selected){e.filterOptions.forEach(e=>{if(e.text===t.detail.item.innerText){e.selected=!e.selected}})}return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_navigateToFilters(t){this._filterStepTwo=false}_changeCurrentFilter(t){this._filterStepTwo=true;this._currentSettings.filters=this._currentSettings.filters.map(e=>{e.selected=e.text===t.detail.item.innerText;return e})}close(){this._dialog&&this._dialog.close()}_focusRecentlyUsedControl(){if(!this._recentlyFocused||!Object.keys(this._recentlyFocused).length){return}const t=this._recentlyFocused.getSelectedItems(),e=this._recentlyFocused.items,i=e[1]&&e[1].assignedNodes&&e[1].assignedNodes().length;if(t.length){t[0].focus()}else if(i){this._recentlyFocused.focusItem(e[1].assignedNodes()[0])}}_confirmSettings(){this.close();this._confirmedSettings=this._currentSettings;this.fireEvent("confirm",this.eventsParams)}_cancelSettings(){this._restoreSettings(this._confirmedSettings);this.fireEvent("cancel",this.eventsParams);this.close()}get eventsParams(){const t=this._currentSettings.sortOrder.filter(t=>t.selected)[0],e=this._currentSettings.sortBy.filter(t=>t.selected)[0],i=t&&t.text,s=!this._currentSettings.sortOrder[0].selected,r=e&&e.text,n=e&&e.index,l=this.sortItems[n];return{sortOrder:i,sortDescending:s,sortBy:r,sortByItem:l,filters:this.selectedFilters}}get selectedFilters(){const t=[];this._currentSettings.filters.forEach(e=>{const i=[];e.filterOptions.forEach(t=>{if(t.selected){i.push(t.text)}});if(i.length){t.push({});t[t.length-1][e.text]=i}});return t}_restoreConfirmedOnEscape(t){if(t.detail.escPressed){this._cancelSettings();this._currentMode="Sort";this._filterStepTwo=false}}_resetSettings(){this._restoreSettings(this._initialSettings);this._filterStepTwo=false;this._recentlyFocused=this._sortOrder;this._focusRecentlyUsedControl()}_restoreSettings(t){this._currentSettings=JSON.parse(JSON.stringify(t))}_onSortOrderChange(t){this._recentlyFocused=this._sortOrder;this._currentSettings.sortOrder=this.initSortOrderItems.map(e=>{e.selected=e.text===t.detail.item.innerText;return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_onSortByChange(t){const e=Number(t.detail.item.getAttribute("data-ui5-external-action-item-index"));this._recentlyFocused=this._sortBy;this._currentSettings.sortBy=this.initSortByItems.map((t,i)=>{t.selected=i===e;return t});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}setConfirmedSettings(t){if(t&&this._dialog&&!this._dialog.isOpen()){const e=JSON.parse(JSON.stringify(this._confirmedSettings));if(t.sortOrder){for(let i=0;i<e.sortOrder.length;i++){if(e.sortOrder[i].text===t.sortOrder){e.sortOrder[i].selected=true}else{e.sortOrder[i].selected=false}}}if(t.sortBy){for(let i=0;i<e.sortBy.length;i++){if(e.sortBy[i].text===t.sortBy){e.sortBy[i].selected=true}else{e.sortBy[i].selected=false}}}if(t.filters){const i={};for(let e=0;e<t.filters.length;e++){i[Object.keys(t.filters[e])[0]]=t.filters[e][Object.keys(t.filters[e])[0]]}for(let t=0;t<e.filters.length;t++){for(let s=0;s<e.filters[t].filterOptions.length;s++){if(i[e.filters[t].text]&&i[e.filters[t].text].indexOf(e.filters[t].filterOptions[s].text)>-1){e.filters[t].filterOptions[s].selected=true}else{e.filters[t].filterOptions[s].selected=false}}}}this._confirmedSettings=JSON.parse(JSON.stringify(e))}}}x.define();var I=x;t.default=I});
//# sourceMappingURL=ViewSettingsDialog.js.map