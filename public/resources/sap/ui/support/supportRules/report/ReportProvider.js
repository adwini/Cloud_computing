/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/base/security/encodeXML","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/ui/support/supportRules/report/Archiver","sap/ui/support/supportRules/report/IssueRenderer"],function(jQuery,e,t,a,n,s,i){"use strict";var r=sap.ui.require.toUrl("sap/ui/support/supportRules/report/resources");var o={line:function(e,a,n,s,i){e.push("<tr><td ",a?"align='right' ":"","valign='top'>","<label class='sapUiSupportLabel'>",t(s||""),"</label></td><td",n?" class='sapUiSupportTechInfoBorder'":"",">");var r=i;if(typeof i==="function"){r=i(e)}e.push(t(r||""));e.push("</td></tr>")},multiline:function(e,t,a,s,i){var r=this;r.line(e,t,a,s,function(e){e.push("<table border='0' cellspacing='0' cellpadding='3'>");jQuery.each(i,function(t,a){var s="";if(a){if(typeof a==="string"||typeof a==="string"||typeof a==="boolean"){s=a}else if(Array.isArray(a)||n(a)){s=JSON.stringify(a)}}r.line(e,false,false,t,""+s)});e.push("</table>")})},subheader:function(e,a){e.push("<tr class='sapUiSupportTitle'><td valign='top' colspan='2'>","<label class='sapUiSupportLabel'>",t(a||""),"</label></td></tr>")}};function p(e){return jQuery.ajax({type:"GET",url:r+"/"+e,dataType:"text"}).then(function(e){return e})}function l(n){var s="";if(!n){return s}try{n.modules.sort();var i=["<div class='sapUiSupportToolbar'>","<div><div class='sapUiSupportTechInfoCntnt'>","<table border='0' cellpadding='3'>"];o.subheader(i,"Support Assistant Information");o.line(i,true,true,"Location",n.supportAssistant.location);o.line(i,true,true,"Version",n.supportAssistant.versionAsString);o.subheader(i,"Application Information");o.line(i,true,true,"SAPUI5 Version",function(e){var a=n.sapUi5Version;if(a&&a.version){var s=a.version;var i=t(s.version||"");e.push(i," (built at ",t(s.buildTimestamp||""),", last change ",t(s.scmRevision||""),")")}else{e.push("not available")}});o.line(i,true,true,"Core Version",function(e){return n.version+" (built at "+n.build+", last change "+n.change+")"});o.line(i,true,true,"Loaded jQuery Version",function(e){return n.jquery});o.line(i,true,true,"User Agent",function(e){return n.useragent+(n.docmode?", Document Mode '"+n.docmode+"'":"")});o.line(i,true,true,"Application",n.appurl);o.multiline(i,true,true,"Configuration (bootstrap)",n.bootconfig);o.multiline(i,true,true,"Configuration (computed)",n.config);if(!a(n.libraries)){o.multiline(i,true,true,"Libraries",n.libraries)}o.multiline(i,true,true,"Loaded Libraries",n.loadedLibraries);o.line(i,true,true,"Loaded Modules",function(e){jQuery.each(n.modules,function(a,s){if(s.indexOf("sap.ui.core.support")<0){e.push("<span>",t(s||""),"</span>");if(a<n.modules.length-1){e.push(", ")}}})});o.multiline(i,true,true,"URI Parameters",n.uriparams);i.push("</table></div>");s=i.join("")}catch(t){e.warning("There was a problem extracting technical info.")}return s}function u(e){var a="<td>";if(e){a+=t(e)}a+="</td>";return a}function c(t){var a="";if(!t){return a}a+='<table class="sapUiTable"><tr><th>Component ID</th><th>Type</th><th>Title</th><th>Subtitle</th><th>Application version</th><th>Description</th><th>BCP Component</th></tr>';try{for(var n=0;n<t.length;n++){var s=t[n];a+="<tr>";a+=u(s.id);a+=u(s.type);a+=u(s.title);a+=u(s.subTitle);if(s.applicationVersion){a+=u(s.applicationVersion.version)}else{a+="<td></td>"}a+=u(s.description);a+=u(s.ach);a+="</tr>"}a+="</table>"}catch(t){e.warning("There was a problem extracting app info.");a=""}return a}function d(e){var t="";t+='<div><span class="sapUiSupportLabel">'+e.displayName+"</span>";t+="<span> ("+e.description+")</span></div>";return t}function f(e,t){var a="";a+='<div><span class="sapUiSupportLabel">'+t.displayName+" with id:</span> "+e;a+="<span> ("+t.description+")</span></div>";return a}function h(e,t){var a="";if(e.length>5){a+='<div class="expandable-control collapsed-content" data-expandableElement="execution-scope-components">';a+='<span class="expandable-title"><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></span></div>"}else{a+='<div><span class="sapUiSupportLabel">'+t.displayName+"</span>";a+="<span> ("+t.description+")</span></div>"}a+='<ol id="execution-scope-components" class="top-margin-xsmall">';for(var n=0;n<e.length;n++){a+="<li>"+e[n]+"</li>"}a+="</ol>";return a}function v(t){var a="";try{var n=t.executionScope.getType();var s=t.scopeDisplaySettings.executionScopes[n];var i=t.scopeDisplaySettings.executionScopeTitle;a+='<div class="sapUiSupportLabel">'+i+": </div>";switch(n){case"global":a+=d(s);break;case"subtree":a+=f(t.executionScope._getContext().parentId,s);break;case"components":a+=h(t.executionScope._getContext().components,s);break}}catch(t){e.warning("There was a problem extracting scope info.");a=""}return a}function b(t){var a="";if(!t){return a}try{var n=1;a+='<table class="sapUiTable"><tbody><tr><th>Name</th><th>Description</th><th>Categories</th><th>Audiences</th></tr></tbody>';for(var s in t){var i=t[s];var r="collapsed-content";if(n===1){r="expanded-content"}var o=t[s].selected?" ("+t[s].issueCount+" issues)":"";var p='<span class="'+(t[s].selected?"checked":"unchecked")+'"></span>';a+='<tbody><tr><td colspan="100" ';a+='class="expandable-control '+r+'" data-expandableElement="section-selected-rules-group'+n+'">'+p;a+='<span class="sapUiSupportLabel expandable-title">'+s+o+"</span>";a+="</td></tr></tbody>";var l="";for(var u in i){var c=i[u].selected?" ("+i[u].issueCount+" issues)":"";var d='<span class="'+(i[u].selected?"checked":"unchecked")+'"></span>';l+="<tr>";l+="<td>"+d+i[u].title+c+"</td>";l+="<td>"+i[u].description+"</td>";l+="<td>"+i[u].categories.join(", ")+"</td>";l+="<td>"+i[u].audiences.join(", ")+"</td>";l+="</tr>"}a+='<tbody id="section-selected-rules-group'+n+'">'+l+"</tbody>";n++}a+="</table>"}catch(t){e.warning("There was a problem extracting selected rules info.");a=""}return a}function m(e){return i.render(e,true)}function g(e){if(!e){return"none"}return"<strong>"+e.title+"/"+e.id+"</strong>"}function y(e,t){if(!t){t=r+"/"}return p("ReportTemplate.html").then(function(a){var n={baseUrl:t,technicalInfo:l(e.technical),issues:m(e.issues),appInfo:c(e.application),rules:b(e.rules),rulePreset:g(e.rulePreset),metadataTitle:e.name+" Analysis Results",metadataTitleTechnicalInfo:"Technical Information",metadataTitleIssues:"Issues",metadataTitleAppInfo:"Application Information",metadataTitleSelectedRules:'Available and (<span class="checked"></span>) Selected Rules',metadataTimestamp:new Date,metadataScope:v(e.scope),metadataAnalysisDuration:e.analysisDuration,metadataAnalysisDurationTitle:e.analysisDurationTitle};return T(a,n)})}function T(e,t){var a,n;for(a in t){n=t[a];e=e.replace(new RegExp("{{"+a+"}}","ig"),n)}return e}function x(e){var t=[this.getReportHtml(e,"./"),p("styles.css"),p("index.js"),p("images/checked.svg"),p("images/collapsed.svg"),p("images/expanded.svg"),p("images/unchecked.svg")];Promise.all(t).then(function(t){var a={issues:e.issues},n={appInfos:e.application},i={technicalInfo:e.technical},r=new s;r.add("technicalInfo.json",i,"json");r.add("issues.json",a,"json");r.add("appInfos.json",n,"json");r.add("report.html",t[0]);r.add("abap.json",e.abap,"json");r.add("styles.css",t[1],"css");r.add("index.js",t[2],"js");r.add("images/checked.svg",t[3],"svg");r.add("images/collapsed.svg",t[4],"svg");r.add("images/expanded.svg",t[5],"svg");r.add("images/unchecked.svg",t[6],"svg");r.download("SupportAssistantReport");r.clear()})}function S(e){var t="";var a=jQuery('<a class="sapUiHidden"></a>');a.on("click",function(){var e=window.open("","_blank");e.opener=null;jQuery(e.document).ready(function(){e.document.documentElement.innerHTML="";e.document.write(t)})});jQuery("body").append(a);this.getReportHtml(e).then(function(e){t=e;a[0].click();a.remove()})}return{getReportHtml:y,downloadReportZip:x,openReport:S}},true);
//# sourceMappingURL=ReportProvider.js.map